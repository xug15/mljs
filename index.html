<!DOCTYPE html>
<html>
<head>
    <title>ML JavaScript</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <!-- Insert this line above script imports  -->
    <script type="text/javascript">
      if (typeof module === 'object') {
        window.module = module; 
        module = undefined;
      }
      </script>

    <script src="dataset-iris/dist/ml-dataset-iris.min.js"></script>
    <script src="ploty/plotly-190419.min.js"></script>

  <!--
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="jquery/jquery.js"></script>
    <link  href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
  -->

    <script src="jquery/1.12.4/jquery.min.js"></script>

    <script src="datatable/jquery.dataTables.js"></script>
    <script src="datatable/dataTables.buttons.min.js"></script>
    <script src="datatable/buttons.flash.min.js"></script>
    <script src="datatable/jszip.min.js"></script>
    <script src="datatable/pdfmake.min.js"></script>
    <script src="datatable/vfs_fonts.js"></script>
    <script src="datatable/buttons.html5.min.js"></script>
    <script src="datatable/buttons.print.min.js"></script>
    
    <link  href="datatable/jquery.dataTables.css" rel="stylesheet">
    <link  href="datatable/buttons.dataTables.min.css" rel="stylesheet">
    
   

    <script src="bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
    <link  href="bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet">
   
    <script src="ml/js-regression.min.js"></script>
    <script src="ml/ml.min.js"></script>
    <script src="ml/ml-logistic-regression.min.js"></script>
    <script src="ml/js-datasets-iris.min.js"></script>

    <script src="ml/math.js"></script>
    <!-- Insert this line after script imports -->
<script type="text/javascript">
  if (window.module)
     module = window.module;
  </script>
   
<style>
  .row{
    margin-left:6vh;
  }
  .borderdiv{
border-radius: 4px;
border: 1px solid #ddd;
box-shadow: 0 1px 4px rgba(0, 0, 0, 0.067);
padding: 15px;
margin: 10px 0px;
}
.button{
  width: 100%;
  margin-top: 5px;
}
.btn-primary{
  border-color: #3d7eb5;
  background-image:linear-gradient(to bottom,#3d7eb5,#0b3e69);
}
.btn-success{
  border-color: #5cb75c;
  background-image:linear-gradient(to bottom,#5cb75c,#0e960e);
}
.btn-info{
  border-color: #69bbd4;
  background-image:linear-gradient(to bottom,#69bbd4,#2f7b92);
}
.btn-warning{
  border-color: #e8ae5c;
  background-image:linear-gradient(to bottom,#e8ae5c,#b77a25);
}
.maringtop{
  margin-top:5px;
}
.textarea{
  width: 35vh;
}
</style>

</head>

<body>
    <div class="container" style="margin:0 10hv;">
      <div class="row" >
        <div class="col-xs-12 col-sm-6" >
            <h1>ML JS Classification</h1>
        </div>
    </div>
    <div class="row" >
      <div class="col-xs-12 col-sm-2" >
        <label>Training sets</label>
      </div>
      
    </div>
    <div class="row" >
      <div class="col-xs-12 col-sm-6" >
        <div class="checkbox">
          <label>
            <input type="checkbox" checked="checked" id="feature_name">Feature name is contained
          </label>
        </div>
      </div>
    </div>
    <div class="row" >
      <div class="col-xs-12 col-sm-6" >
        <textarea id="training_decision" style="margin:4px;border-color: #d1d1d1;" class="textarea" rows="3" placeholder="5.1,3.5,1.4,0.2
4.9,3.1,1.4,0.2
4.7,3.2,1.3,0.2"></textarea>
      </div>
    </div>
    <div class="row" style="margin-top:5px;">
      <div class="col-xs-12 col-sm-2" >
        <span>Upload your data:</span>
      </div>
      <div class="col-xs-12 col-sm-6" >
        <input type="file" style="border-color: #d1d1d1;" id="data_input" >
      </div>
    </div>
    <div class="row" >
      <div class="col-xs-12 col-sm-6" >
        <label>Labels</label>
      </div>
    </div>
    <div class="row" >
      <div class="col-xs-12 col-sm-6" >
        <textarea id="label_decision" style="margin:4px;border-color: #d1d1d1;" class="textarea" rows="3" placeholder="0
0
0"></textarea>
      </div>
    </div>
    <div class="row" style="margin-top:5px;">
      <div class="col-xs-12 col-sm-2" >
        Upload the label of data:
      </div>
      <div class="col-xs-12 col-sm-6" >
        <input type="file" style="border-color: #d1d1d1;" id="label_input" >
      </div>
    </div>
    <div class="row" >
        <div class="col-xs-12 col-sm-2" >
            <button class="btn" style="border-color: #d1d1d1;margin:5px;" onclick="demo_data()">Demo data</button>
          </div>
    </div>
    <div class="row" style="display:none;">
        <div class="col-xs-12 col-sm-2" >
            <button class="btn" style="border-color: #d1d1d1;margin:5px;" onclick="update_data()">Update data</button>
          </div>
    </div>
    <div class="row" >
      <div class="col-xs-12 col-sm-6" >
        <button class="btn btn-primary button" onclick="train_pca()"><span class="glyphicon glyphicon-play"></span>PCA analysis</button>
      </div>
    </div>
    <div class="row" >
      <div class="col-xs-12 col-sm-6" >
        <button class="btn btn-primary button" onclick="train_logistic()"><span class="glyphicon glyphicon-play"></span>Logistic Regression Training</button>
      </div>
    </div>
    <div class="row" >
      <div class="col-xs-12 col-sm-6" >
        <button class="btn btn-primary button" onclick="train_decision()"><span class="glyphicon glyphicon-play"></span>Decision Tree Training</button>
      </div>
    </div>
    
    <div class="row" >
      <div class="col-xs-12 col-sm-6" >
        <button class="btn btn-primary button" onclick="train_randomforest()"><span class="glyphicon glyphicon-play"></span>Random Forest Training</button>
      </div>
    </div>

    <div class="row" >
      <div class="col-xs-12 col-sm-6" >
        <button class="btn btn-primary button" onclick="feature_evalue()"><span class="glyphicon glyphicon-play"></span>Feature evaluation</button>
      </div>
    </div>

    <div class="row" style="margin-top:5px;">
      <div class="col-xs-12 col-sm-6" >
        <input type="file" id="file-input" >
      </div>
    </div>
    <div class="row" >
      <div class="col-xs-12 col-sm-6" >
        <button class="btn btn-success maringtop color2" onclick="loadmodule()">Upload module</button>
      </div>
    </div>
    <div class="predict_pca" style="display:none;">
      <div class="row" >
        <div class="col-xs-12 col-sm-10" >
          <h2 style="text-align: center">PCA result:</h2>
        </div>
      </div>
    <div class="row" >
      <div class="col-xs-12 col-sm-6" >
              <button class="btn btn-info maringtop" onclick="download_pca()"><span class="glyphicon glyphicon-download-alt"></span>
                Download PCA module</button>
      </div><!--col-xs-12-->
    </div><!--row-->
    <div class="row" >
        <div class="col-xs-12 col-sm-6" >
            <label>Origin data </label>
        </div><!--col-xs-12-->
      </div><!--row-->
      <div class="row" >
          <div class="col-xs-12 col-sm-6" >
              <p>Select 3 dimential data to display</p>
              
          </div><!--col-xs-12-->
      </div><!--row-->
      <div class="row" >
          <div class="col-xs-10 col-sm-10" >
              <div class="borderdiv" id='3dplot' style="height:59vh;"></div> 
          </div><!--col-xs-12-->
      </div><!--row-->
      <div class="row" >
          <div class="col-xs-12 col-sm-6" >

          </div><!--col-xs-12-->
      </div><!--row-->

      <div class="row" >
          <div class="col-xs-12 col-sm-6" >
              <label>PCA analysis data</label>
              
              <hr>
          </div><!--col-xs-12-->
        </div><!--row-->
        <div class="row" >
            <div class="col-xs-12 col-sm-6" >
                <p>Select 3 biggest divation to display</p>
                
            </div><!--col-xs-12-->
        </div><!--row-->
        <div class="row" >
            <div class="col-xs-10 col-sm-10" >
                <div class="borderdiv" id='3dplotnew' style="height:59vh;"></div>
            </div><!--col-xs-12-->
        </div><!--row-->
        <div class="row" >
            <div class="col-xs-12 col-sm-6" >
              
            </div><!--col-xs-12-->
          </div><!--row-->

  </div><!--predict_pca-->
  <div class="predict_logistic" style="display:none;">
    <div class="row" >
      <div class="col-xs-12 col-sm-10" >
        <h2 style="text-align: center">Logistic Regression result</h2>
      </div><!--col-xs-12-->
    </div><!--row-->

      <div class="row" >
          <div class="col-xs-12 col-sm-6" >
              <label>Logistic Regression Prediction data</label>
          </div><!--col-xs-12-->
        </div><!--row-->
        <div id="roc_plot"></div>
        <div class="row" >
          <div class="col-xs-12 col-sm-6" >
              
          </div><!--col-xs-12-->
        </div><!--row-->
        <div class="row" style="display:none;" >
            <div class="col-xs-12 col-sm-6" >
                <textarea id="predict_decision_input" style="margin:4px;" class="textarea"  rows="3" placeholder="[5.1,3.5,1.4,0.2]">[5.1,3.5,1.4,0.2],[4.9,3,1.4,0.2],[6,2.9,4.5,1.5],[5.7,2.6,3.5,1]</textarea>
            </div><!--col-xs-12-->
          </div><!--row-->
          <div class="row" >
              <div class="col-xs-12 col-sm-6" >
                  <button class="btn  btn-info" onclick="download_logistic()"><span class="glyphicon glyphicon-download-alt"></span>
                    Download Logistic Regression module</button>
              </div><!--col-xs-12-->
            </div><!--row-->
            <div class="row" >
                <div class="col-xs-12 col-sm-6" >
                    <button class="btn btn-success maringtop" onclick="prediction_logistic()">Logistic Regression Prediction</button>
                </div><!--col-xs-12-->
              </div><!--row-->
              <div class="row" >
                  <div class="col-xs-12 col-sm-10" style="margin: 5px;padding: 10px;border: 1px solid #d1d1d1;">
                      <div id="result_logistic"></div>
                  </div><!--col-xs-12-->
                </div><!--row-->
    </div>

    <div class="predict_decision" style="display:none;">
        <div class="row" >
            <div class="col-xs-12 col-sm-6" >
                <label>Decision tree Prediction data</label>
            </div><!--col-xs-12-->
          </div><!--row-->
          <div class="row" >
              <div class="col-xs-12 col-sm-6" >
                  <textarea id="predict_decision_input" style="margin:4px;" class="textarea"  rows="3" placeholder="[5.1,3.5,1.4,0.2]">[5.1,3.5,1.4,0.2],[4.9,3,1.4,0.2],[6,2.9,4.5,1.5],[5.7,2.6,3.5,1]</textarea>
              </div><!--col-xs-12-->
            </div><!--row-->
            <div class="row" >
                <div class="col-xs-12 col-sm-6" >
                    <button class="btn btn-info" onclick="download_decisiontree()"><span class="glyphicon glyphicon-download-alt"></span>
                      Download Decision Tree module</button>
                </div><!--col-xs-12-->
              </div><!--row-->
              <div class="row" >
                  <div class="col-xs-12 col-sm-6" >
                      <button class="btn btn-success maringtop" onclick="prediction_decision()">Decision Tree Prediction</button>
                  </div><!--col-xs-12-->
                </div><!--row-->
                <div class="row" >
                    <div class="col-xs-12 col-sm-6" >
                        <div id="result_dicision"></div>
                    </div><!--col-xs-12-->
                  </div><!--row-->
    </div>

    <div class="predict_randomforest" style="display:none;">
        <div class="row" >
            <div class="col-xs-12 col-sm-6" >
                <label>Random Forest Prediction data</label>
            </div><!--col-xs-12-->
          </div><!--row-->
          <div class="row" >
              <div class="col-xs-12 col-sm-6" >
                  <textarea id="predict_randomforest_input" style="margin:4px;" class="textarea"  rows="3" placeholder="[5.1,3.5,1.4,0.2]">[5.1,3.5,1.4,0.2],[4.9,3,1.4,0.2],[6,2.9,4.5,1.5],[5.7,2.6,3.5,1]</textarea>
              </div><!--col-xs-12-->
            </div><!--row-->
            <div class="row" >
                <div class="col-xs-12 col-sm-6" >
                    <button class="btn btn-info" onclick="download_randomforest()">
                        <span class="glyphicon glyphicon-download-alt"></span>
                        Download Random Forest module</button>
                </div><!--col-xs-12-->
              </div><!--row-->
              <div class="row" >
                  <div class="col-xs-12 col-sm-6" >
                      <button class="btn btn-success maringtop" onclick="prediction_randomforest()">Random Forest Prediction</button>
                  </div><!--col-xs-12-->
                </div><!--row-->
                <div class="row" >
                    <div class="col-xs-12 col-sm-6" >
                        <div id="result_randomforest"></div>
                    </div><!--col-xs-12-->
                  </div><!--row-->
    </div>
    <div class="row" >
      <div class="col-xs-12 col-sm-6" >
      </div><!--col-xs-12-->
    </div><!--row-->

    <div class="row" >
      <div class="col-xs-12 col-sm-10" style="margin:5px;  display:none;padding:10px;" id="feature_performance">
        <h2 style="text-align: center;">Feature evaluation result</h2>
        <div id="feature_performance_table" style="border:1px solid #d1d1d1; margin:5px; padding:10px;"></div>
      </div><!--col-xs-12-->
    </div><!--row-->

    <div class="row" >
      <div class="col-xs-12 col-sm-6" >
      </div>
    </div>
    <div class="container">
        <fieldset style="display: none;">
          <legend>Exponential regression</legend>
          <label>X value</label>
          <textarea id="exponentialx" class="textarea" style="margin:4px;"  rows="3" placeholder="0, 1, 2, 3, 4">0,1,2,3,4</textarea>
          <label>Y value</label>
          <textarea id="exponentialy" class="textarea" style="margin:4px;"  rows="3" placeholder="1.5, 2.5, 3.5, 5.0, 7.5">1.5,2.5,3.5,5.0,7.5</textarea>
          <label >
          </label>
          <button class="btn" onclick="exponential()">Click me</button>
          <hr>
        </fieldset>
        <div id="info"></div>
        <div id="plot"></div>
        <div id="decision_info"></div>
        <label>
        </label>
        <div>
        </div>
        <div style="margin:10px;">
        </div>
      </fieldset>
      <div style="margin-bottom: 200px;"></div>
    </div>
<script src="ml/mljsxg.js"></script>

<script type="text/javascript">
function getinforvalue(trainid){
  //var trainid='training_decision';
  //get the html data
  /*
  1. datacontents is test the data from box or upload file. If the upload file was found, it would be first used.
  2. if the file is empty, we will use the box value.
  */ 
  if(typeof datacontents==="undefined"){
    var decision_data=document.getElementById(trainid).value;
  }else if(datacontents.length>0){
    var decision_data=datacontents;
  }else{
    var decision_data=document.getElementById(trainid).value;
  }
  var test_feature_name=document.getElementById('feature_name').checked;
  
  //decision_label=document.getElementById("label_decision").value;

  //transforme data formate.
  var data=decision_data.split('\n');
  var dataarr=[];
  var dataarr2=[];
  feature_name_array=[];
  /*
  If the upload file was not cantained the name of features.
  We will use the number to represent the each of features. 
  */
  if(!test_feature_name){
    for(var i=0;i<data[0].length;i++)
    {
      feature_name_array.push(i);
    }
  }

  for(var i=0;i<data.length;i++){
    var row=[];
    /*
    If the name of header is provided, and the first line will be treated like name array.
    Other will betreat like the numbers.
    */
   if(i==0 & test_feature_name)
   {
    row=data[i].split(',').map(function(item) 
      {
      return item;
      });
   }else{
    row=data[i].split(',').map(function(item) 
      {
      return parseFloat(item);
      });
   }
  /*
  The header will be given to the feature name array.
  Other data will be put into the dataarr.
  */
    if(i==0 & test_feature_name)
    {
      feature_name_array=row;
    }else
    {
      dataarr.push(row);
      //
    }
  }
  //console.log(dataarr);
  return dataarr;
}
// getinforvalue('training_decision')
// a like
// [1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1]
// b (3) [Array(800), Array(800), Array(800)]
// [[1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1],...]
function mljs_label_entropy(a,b)
{
  //a is the label of fact.
  //b is the array of use probability to predict label.
  //c is the begin entropy.
  var pro=[];
  var tprarr=[];
  var fprarr=[];
  var entropy_array=[];
  var entropy_change=[];
  var information_gain=[];
  var other=[];
  var gain_ratio_array=[];
  var iv_array=[];
  var gini_index_array=[];
  for(var i=0;i<b.length;i++){
    // each cut off label is b[i]
    var tp=0;
    var tn=0;
    var fp=0;
    var fn=0;
    for(var j=0;j<b[i].length;j++){
      if(b[i][j]==1 & a[j]==1){
        tp++;
      }
      if(b[i][j]==0 & a[j]==0){
        tn++;
      }
      if(b[i][j]==0 & a[j]==1){
        fn++;
      }
      if(b[i][j]==1 & a[j]==0){
        fp++;
      }
    }
    //
    tpr=tp/(tp+fn);

    fpr=fp/(tn+fp);

    //
    fprarr.push(fpr);
    tprarr.push(tpr);

    //the total number;
    var all=tp+tn+fp+fn;
    // the actual number;
    var postive=tp+fn;
    var negative=tn+fp;
    //the above the throeshold. and below the thoreshold.
    var above=tp+fp;
    var below=tn+fn;
    // the actuall positive portion of the total number.
    var pos_ratio=postive/all;
    var neg_ratio=negative/all;

    var tp_above=tp/above;
    var fp_above=fp/above;
    var tn_below=tn/below;
    var fn_below=fn/below;
    //gini index begin
    var gini_index=(1-Math.pow((tp/above),2)-Math.pow((fp/above),2))*(above/all)+(1-Math.pow((tn/below),2)-Math.pow((fn/below),2))*(below/all);
    if(isNaN(gini_index)){
      gini_index=10;
    }
    gini_index_array.push(gini_index);
    //gini index end

    //iv
    var iv=(-1)*(above/all)*log2(above/all)+(-1)*(below/all)*log2(below/all);
    //entropy
    var entropy=(-1)*(pos_ratio*log2(pos_ratio)+neg_ratio*log2(neg_ratio));
    entropy_array.push(entropy);
    //the entropy of classification.
    var change=(-1)*(above/all)*(tp_above*log2(tp_above)+fp_above*log2(fp_above))+(-1)*(below/all)*(tn_below*log2(tn_below)+fn_below*log2(fn_below));
    entropy_change.push(change);
    // is the change is NaN then gain of information is 0.
    var information=0;
    if(isNaN(entropy-change)){
        information=0;
      }else{
        information=entropy-change;
      }
      information_gain.push(information);
      if(isNaN(iv)){
        iv=1;
      }
      //
      iv_array.push(iv);
      var gain_ratio=information/iv;
      gain_ratio_array.push(gain_ratio);
      other.push(iv);
  }
  var auc=0;
  for(var i=1;i<fprarr.length;i++){
    auc+=(tprarr[i]+tprarr[i-1])*(fprarr[i]-fprarr[i-1])/2;
  }
  //auc=auc.toFixed(3);
  //auc=Math.abs(auc).toFixed(3);
  auc=Math.abs(auc);
  if(auc<0.5)
  {
    auc=1-auc;
  }
  auc=auc.toFixed(4)*1;
  var information_gain_value=Math.max(...information_gain).toFixed(4)*1;
  var gain=Math.max(...gain_ratio_array).toFixed(4)*1;
  var gini_index_min=Math.min(...gini_index_array).toFixed(4)*1;
  return [auc,information_gain_value,gain,gini_index_min];
}

//
c=[[1,2,3,4],[1,2,3,4],[1,2,3,4]];
function transforme_array(a2)
{
  //Deep copy array.
  a=JSON.parse(JSON.stringify(a2));
  //Create by feature array
  var b=[];
  for(var j=0;j<a[0].length;j++)
    {
      b.push([]);
    }
    // put feature into each array.
  for(var i=0;i<a.length;i++)
  {
    for(var j=0;j<a[i].length;j++)
    {
      b[j].push(a[i][j]);
    }
  }
  return b;
}

//function log2
function log2(a){
  var b=Math.log(a)/Math.log(2);
  return b;
}
// Use array to generate two unique array, and each count.
function sort_count(arr2){
  arr=JSON.parse(JSON.stringify(arr2));
  if (arr.length === 0) return arr;
  arr = arr.sort(function (a, b) { return a*1 - b*1; });
  var ret = [arr[0]];
  for (var i = 1; i < arr.length; i++) { //Start loop at 1: arr[0] can never be a duplicate
    if (arr[i-1] !== arr[i]) {
      ret.push(arr[i]);
    }
  }
  var out=[];
  for(var j=0;j<ret.length;j++)
  {
    var count = 0;
    for(let i=0; i<arr.length; i++)
    {
      if (arr[i]==ret[j]){
        count++;
      }   
    }
    out.push(count);
  }
  return [ret,out];
}
// Use the calculate the entropy.
function entropy(arr2){
  arr=JSON.parse(JSON.stringify(arr2));
  var sum=0;
  for(var i=0;i<arr.length;i++)
  {
    sum+=arr[i];
  }
  var entropy_value=0;
  var array=[];
  for(var i=0;i<arr.length;i++)
  {
    var a=arr[i]/sum;
    var b=a*log2(a);
    entropy_value+=b*(-1);
    array.push(b);
  }
  return [sum,entropy_value,array];

}


console.log(log2(2));
console.log(log2(4));
console.log(log2(8));
function feature_evalue()
{
//get data;
data= getinforvalue('training_decision');
var label=getinforlabel('label_decision');
var label_unique=sort_unique(label);
//
var out=sort_count(label);
console.log(out);
console.log(entropy(out[1]));
feature_array=transforme_array(data);
feature_cutoff_array=[];
for(var i=0;i<feature_array.length;i++)
{
  feature_cutoff_array.push([]);
  feature_cutoff_array[i]=cutoff(feature_array[i]);
}
feature_label=[];
for(var i=0;i<feature_array.length;i++)
{
  feature_label.push([]);
  feature_label[i]=mljs_determin_label(feature_array[i],feature_cutoff_array[i]);
}
feature_auc=[];
feature_entropy=[];
for(var i=0;i<feature_array.length;i++)
  {
    feature_auc.push([]);
    feature_entropy.push([]);
    feature_auc[i]=mljs_label_cross(label,feature_label[i]);
    feature_entropy[i]=mljs_label_entropy(label,feature_label[i])
  }
console.log(feature_entropy);
table_html='<table class="table"  id="feature_evalue_table"> \
  <thead> \
    <tr> \
      <th scope="col">Number</th> \
      <th scope="col">AUC</th> \
      <th scope="col">Information Gain</th> \
      <th scope="col">Gain ratio</th> \
      <th scope="col">Gini index</th> \
    </tr> \
  </thead> \
  <tbody>';
for(var i=0;i<feature_entropy.length;i++)
  {
    table_html+='<tr> \
      <th scope="row">'+feature_name_array[i]+'</th> \
      <td>'+ feature_entropy[i][0]+'</td> \
      <td>'+ feature_entropy[i][1]+'</td> \
      <td>'+ feature_entropy[i][2]+'</td> \
      <td>'+ feature_entropy[i][3]+'</td> \
    </tr>';
  }
  table_html+='</tbody></table>';
  document.getElementById("feature_performance").style.display = "block";
  document.getElementById("feature_performance_table").innerHTML = table_html;
  $('#feature_evalue_table').DataTable({
    dom: 'Bfrtip',
        buttons: [
             'csv', 'excel'
        ]
  });
  
}

/*
a=[1,1,1,2,2,3,4,5,5,5,6,6,6,7,7,8,8];
console.log(a);
b=sort_count(a)
console.log(b);
console.log(entropy(b[1]));
*/

function select_data_from_id()
{

//get data;
var data= getinforvalue('training_decision');
var label=getinforlabel('label_decision');
var label_unique=sort_unique(label);
//console.log(label_unique);
//merge_matrix()


merge_array=merge_matrix(data,label);
//console.log(merge_array);
merge_array=shufflearray(merge_array);
//console.log(merge_array);
//
var train_range_ratio=[0,1];
var validate_range_ratio=[0,1];
var train_range=[];
var validate_range=[];
var number=parseInt(train_range_ratio[1]*(data.length)) ;

//train_range_ratio[1]*(data.length);
train_range.push(parseInt(train_range_ratio[0]*(data.length)));
train_range.push(parseInt(train_range_ratio[1]*(data.length)));
//
validate_range.push(parseInt(validate_range_ratio[0]*(data.length)));
validate_range.push(parseInt(validate_range_ratio[1]*(data.length)));

//
var train=generate_train_validate_data(label_unique,train_range,merge_array);
trainingData =train[0];
trainingLabel=train[1];
var valide=generate_train_validate_data(label_unique,validate_range,merge_array);
validateData=valide[0];
validateLabel=valide[1];

/*
model=train_model(trainingData[0][1]);
proarr=model_data_probability(model,validateData[0][1]);
rocarray=mljs_validate(proarr,validateLabel[0][1]);
console.log(rocarray);
*/
var config_model='';
var data=[];
for(var i=0;i<trainingData.length;i++)
  {
    var row=[];
    row.push(trainingData[i][0]);
    var name='model'+i;
    window[name]=train_model_new(trainingData[i][1]);
    //model=
    config_model+='<p>'+trainingData[i][0]+" "+window[name].weight+" intercept"+window[name].intercept+'</p>';
    proarr=model_data_probability(window[name],validateData[i][1]);
    rocarray=mljs_validate(proarr,validateLabel[i][1]);
    row.push(rocarray[3]);
    row.push(rocarray[1]);
    row.push(rocarray[2]);
    //console.log(row);
    data.push(row);
  }
  html_logistic_table='<table class="table"  id="logistic_table"> \
  <thead> \
    <tr> \
      <th scope="col">Name</th> ';
      for (var i=0;i<trainingData.length;i++)
      {
        html_logistic_table+='<th scope="col">Model '+i+' weight</th>';
      }
      html_logistic_table+='</tr> \
  </thead> \
  <tbody>';
    for(j=0;j<feature_name_array.length;j++){
      html_logistic_table+='<tr>\
          <td>'+feature_name_array[j]+'</td> ';
          for(i=0;i<trainingData.length;i++){
            var name='model'+i;
            html_logistic_table+='<td>'+ window[name].weight[j]+'</td>';
          }
          html_logistic_table+='</tr>';

    }
    html_logistic_table+='</tbody></table>';
    
    document.getElementById("result_logistic").innerHTML = html_logistic_table;
    $('#logistic_table').DataTable({
    dom: 'Bfrtip',
        buttons: [
             'csv', 'excel'
        ]
  });

  //console.log(data);
  plot_roc(data,'roc_plot');

}

function dealwithna()
{
  
}


function dealwithna_replace_with_0()
{
  //get data;
  var data= getinforvalue('training_decision');
  var label=getinforlabel('label_decision');
  //deep copy
  var data1=transforme_array(data);

//replace na with 0.
  for(var i=0;i<data1.length;i++)
    {
      for(var j=0;j<data1[i].length;j++)
      {
        if(isNaN(data1[i][j]) | data1[i][j]==null){
          data1[i][j]=0;
          //console.log(i+' '+j);
        }
      }
    }
    return data1
}

//
function array_mean_with_na(a){
var counter=0;
var sum=0;
  for(var i=0;i<a.length;i++)
  {
    if(isNaN(a[i]) | a[i]==null){
      continue;
      }else{
        counter+=1;
        sum+=a[i];
      }
  }
  var average=sum/counter;
  return average;
}
//

function dealwithna_replace_with_mean()
{
  //get data;
  var data= getinforvalue('training_decision');
  var label=getinforlabel('label_decision');
  //replace na with mean.
  //1. transpose data matrix.
  feature_array=transforme_array(data);
  //deep copy the feature array.
  feature_array_replace_mean=JSON.parse(JSON.stringify(feature_array));
  //2. calculate each feature mean.
  feature_mean_array=[];
  for(var i=0;i<feature_array.length;i++)
    {
      feature_mean_array.push(array_mean_with_na(feature_array[i]));//push each feature mean to array.
    }
    //read each feature value array.
    for(var i=0;i<feature_array_replace_mean.length;i++)
    {
      //loop each value in feature.
      for(var j=0;j<feature_array_replace_mean[i].length;j++)
      {
        //test if the feature is na or null will be replaced with mean.
        if(isNaN(feature_array_replace_mean[i][j]) | feature_array_replace_mean[i][j]==null)
        {
          feature_array_replace_mean[i][j]=feature_mean_array[i];
        }
      }
    }
  return feature_array_replace_mean;
}
//
function array_median_with_na(a){
  var median_array=[];
//Test the each element is NaN or null or not.
  for(var i=0;i<a.length;i++)
  {
    if(isNaN(a[i]) | a[i]==null){
      continue;
      }else{//if not, then calculate the number of number and the total of numbers.
      median_array.push(a[i]);  
      }
  }
  // sort the array with small to big.
  media_array_sort=median_array.sort(function(a,b){return a-b});
  //divide with 2 and get remainder.
  if(media_array_sort.length%2==1){//odd number
    var index=Math.round(media_array_sort.length/2)-1;
    // get the median index
    return media_array_sort[index];
  }else{//even number.
    var index=media_array_sort.length/2;
    // get the middle
    var index2=index-1;
    var avg=(media_array_sort[index2]+media_array_sort[index])/2
    return avg;
  }
  
}
//
function dealwithna_replace_with_median()
{
  //get data;
  var data= getinforvalue('training_decision');
  var label=getinforlabel('label_decision');
  //replace na with mean.
  //1. transpose data matrix.
  feature_array=transforme_array(data);
  //deep copy the feature array.
  feature_array_replace_median=JSON.parse(JSON.stringify(feature_array));
  //2. calculate each feature mean.
  feature_median_array=[];
  for(var i=0;i<feature_array.length;i++)
    {
      feature_median_array.push(array_median_with_na(feature_array[i]));//push each feature mean to array.
    }
    //read each feature value array.
    for(var i=0;i<feature_array_replace_median.length;i++)
    {
      //loop each value in feature.
      for(var j=0;j<feature_array_replace_median[i].length;j++)
      {
        //test if the feature is na or null will be replaced with mean.
        if(isNaN(feature_array_replace_median[i][j]) | feature_array_replace_median[i][j]==null)
        {
          feature_array_replace_median[i][j]=feature_median_array[i];
        }
      }
    }
  return feature_array_replace_median;
}

</script>  



</body>
</html>