<!DOCTYPE html>
<html>
<head>
    <title>ML JavaScript</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	  <meta charset="UTF-8">
    
    <script src="dataset-iris/dist/ml-dataset-iris.min.js"></script>
    <script src="ploty/plotly-190419.min.js"></script>

 
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="jquery/jquery.js"></script>
    <link  href="bootstrap/css/bootstrap.min.css" rel="stylesheet">

 
    <!--
    <script src="jquery/1.12.4/jquery.min.js"></script>
    <script src="bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
    <link  href="bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet">
    -->
    

    <script src="ml/ml.min.js"></script>
    <script src="ml/ml-logistic-regression.min.js"></script>
   
<style>
  .borderdiv{
border-radius: 4px;
border: 1px solid #ddd;
box-shadow: 0 1px 4px rgba(0, 0, 0, 0.067);
padding: 15px;
margin: 10px 0px;
}
</style>

</head>

<body>

    <div class="container">
        <fieldset style="display: none;">
          <legend>Exponential regression</legend>
          <label>X value</label>
          <textarea id="exponentialx" rows="3" placeholder="0, 1, 2, 3, 4">0,1,2,3,4</textarea>
          <label>Y value</label>
          <textarea id="exponentialy" rows="3" placeholder="1.5, 2.5, 3.5, 5.0, 7.5">1.5,2.5,3.5,5.0,7.5</textarea>

          <label >
            
          </label>
          <button class="btn" onclick="exponential()">Click me</button>
          <hr>
        </fieldset>
        <div id="info"></div>
        <div id="plot"></div>
        <div id="decision_info"></div>
        
        <legend>ML JS Classification</legend>
        <label>Training sets</label>
        <textarea id="training_decision" rows="3" placeholder="0, 1, 2, 3, 4">[5.1,3.5,1.4,0.2],[4.9,3,1.4,0.2],[4.7,3.2,1.3,0.2],[4.6,3.1,1.5,0.2],[5,3.6,1.4,0.2],[5.4,3.9,1.7,0.4],[4.6,3.4,1.4,0.3],[5,3.4,1.5,0.2],[4.4,2.9,1.4,0.2],[4.9,3.1,1.5,0.1],[5.4,3.7,1.5,0.2],[4.8,3.4,1.6,0.2],[4.8,3,1.4,0.1],[4.3,3,1.1,0.1],[5.8,4,1.2,0.2],[5.7,4.4,1.5,0.4],[5.4,3.9,1.3,0.4],[5.1,3.5,1.4,0.3],[5.7,3.8,1.7,0.3],[5.1,3.8,1.5,0.3],[5.4,3.4,1.7,0.2],[5.1,3.7,1.5,0.4],[4.6,3.6,1,0.2],[5.1,3.3,1.7,0.5],[4.8,3.4,1.9,0.2],[5,3,1.6,0.2],[5,3.4,1.6,0.4],[5.2,3.5,1.5,0.2],[5.2,3.4,1.4,0.2],[4.7,3.2,1.6,0.2],[4.8,3.1,1.6,0.2],[5.4,3.4,1.5,0.4],[5.2,4.1,1.5,0.1],[5.5,4.2,1.4,0.2],[4.9,3.1,1.5,0.2],[5,3.2,1.2,0.2],[5.5,3.5,1.3,0.2],[4.9,3.6,1.4,0.1],[4.4,3,1.3,0.2],[5.1,3.4,1.5,0.2],[5,3.5,1.3,0.3],[4.5,2.3,1.3,0.3],[4.4,3.2,1.3,0.2],[5,3.5,1.6,0.6],[5.1,3.8,1.9,0.4],[4.8,3,1.4,0.3],[5.1,3.8,1.6,0.2],[4.6,3.2,1.4,0.2],[5.3,3.7,1.5,0.2],[5,3.3,1.4,0.2],[7,3.2,4.7,1.4],[6.4,3.2,4.5,1.5],[6.9,3.1,4.9,1.5],[5.5,2.3,4,1.3],[6.5,2.8,4.6,1.5],[5.7,2.8,4.5,1.3],[6.3,3.3,4.7,1.6],[4.9,2.4,3.3,1],[6.6,2.9,4.6,1.3],[5.2,2.7,3.9,1.4],[5,2,3.5,1],[5.9,3,4.2,1.5],[6,2.2,4,1],[6.1,2.9,4.7,1.4],[5.6,2.9,3.6,1.3],[6.7,3.1,4.4,1.4],[5.6,3,4.5,1.5],[5.8,2.7,4.1,1],[6.2,2.2,4.5,1.5],[5.6,2.5,3.9,1.1],[5.9,3.2,4.8,1.8],[6.1,2.8,4,1.3],[6.3,2.5,4.9,1.5],[6.1,2.8,4.7,1.2],[6.4,2.9,4.3,1.3],[6.6,3,4.4,1.4],[6.8,2.8,4.8,1.4],[6.7,3,5,1.7],[6,2.9,4.5,1.5],[5.7,2.6,3.5,1],[5.5,2.4,3.8,1.1],[5.5,2.4,3.7,1],[5.8,2.7,3.9,1.2],[6,2.7,5.1,1.6],[5.4,3,4.5,1.5],[6,3.4,4.5,1.6],[6.7,3.1,4.7,1.5],[6.3,2.3,4.4,1.3],[5.6,3,4.1,1.3],[5.5,2.5,4,1.3],[5.5,2.6,4.4,1.2],[6.1,3,4.6,1.4],[5.8,2.6,4,1.2],[5,2.3,3.3,1],[5.6,2.7,4.2,1.3],[5.7,3,4.2,1.2],[5.7,2.9,4.2,1.3],[6.2,2.9,4.3,1.3],[5.1,2.5,3,1.1],[5.7,2.8,4.1,1.3],[6.3,3.3,6,2.5],[5.8,2.7,5.1,1.9],[7.1,3,5.9,2.1],[6.3,2.9,5.6,1.8],[6.5,3,5.8,2.2],[7.6,3,6.6,2.1],[4.9,2.5,4.5,1.7],[7.3,2.9,6.3,1.8],[6.7,2.5,5.8,1.8],[7.2,3.6,6.1,2.5],[6.5,3.2,5.1,2],[6.4,2.7,5.3,1.9],[6.8,3,5.5,2.1],[5.7,2.5,5,2],[5.8,2.8,5.1,2.4],[6.4,3.2,5.3,2.3],[6.5,3,5.5,1.8],[7.7,3.8,6.7,2.2],[7.7,2.6,6.9,2.3],[6,2.2,5,1.5],[6.9,3.2,5.7,2.3],[5.6,2.8,4.9,2],[7.7,2.8,6.7,2],[6.3,2.7,4.9,1.8],[6.7,3.3,5.7,2.1],[7.2,3.2,6,1.8],[6.2,2.8,4.8,1.8],[6.1,3,4.9,1.8],[6.4,2.8,5.6,2.1],[7.2,3,5.8,1.6],[7.4,2.8,6.1,1.9],[7.9,3.8,6.4,2],[6.4,2.8,5.6,2.2],[6.3,2.8,5.1,1.5],[6.1,2.6,5.6,1.4],[7.7,3,6.1,2.3],[6.3,3.4,5.6,2.4],[6.4,3.1,5.5,1.8],[6,3,4.8,1.8],[6.9,3.1,5.4,2.1],[6.7,3.1,5.6,2.4],[6.9,3.1,5.1,2.3],[5.8,2.7,5.1,1.9],[6.8,3.2,5.9,2.3],[6.7,3.3,5.7,2.5],[6.7,3,5.2,2.3],[6.3,2.5,5,1.9],[6.5,3,5.2,2],[6.2,3.4,5.4,2.3],[5.9,3,5.1,1.8]</textarea>
        <label>Labels</label>
        <textarea id="label_decision" rows="3" placeholder="1.5, 2.5, 3.5, 5.0, 7.5">0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2</textarea>
        <label>
          
        </label>
  
        <button class="btn btn-info" onclick="train_pca()">PCA analysis</button>
        <button class="btn btn-info" onclick="train_logistic()">Logistic Regression Training</button>
        <button class="btn btn-info" onclick="train_decision()">Decision Tree Training</button>
        <button class="btn btn-info" onclick="train_randomforest()">Random Forest Training</button>

        <div class="predict_pca" style="display:none;">
          <div style="margin:20px;"></div>
          <button class="btn btn-success" onclick="download_pca()"><span class="glyphicon glyphicon-download-alt"></span>
            Download PCA module</button>
          <label>Origin data </label>
          <p>Select 3 dimential data to display</p>
          <div class="borderdiv" id='3dplot'></div>
        

          <label>PCA analysis data</label>
          <p>Select 3 biggest divation to display</p>
          <div class="borderdiv" id='3dplotnew'></div>
          <hr>
        </div>

        <div class="predict_logistic" style="display:none;">
          <label>Logistic Regression Prediction data</label>
          <textarea id="predict_decision_input" rows="3" placeholder="[5.1,3.5,1.4,0.2]">[5.1,3.5,1.4,0.2],[4.9,3,1.4,0.2],[6,2.9,4.5,1.5],[5.7,2.6,3.5,1]</textarea>
          <label></label>
          <button class="btn btn-success" onclick="download_logistic()"><span class="glyphicon glyphicon-download-alt"></span>
            Download Logistic Regression module</button>
          <button class="btn" onclick="prediction_logistic()">Logistic Regression Prediction</button>
          <div id="result_logistic"></div>
          <hr>
        </div>

        <div class="predict_decision" style="display:none;">
          <label>Decision tree Prediction data</label>
          <textarea id="predict_decision_input" rows="3" placeholder="[5.1,3.5,1.4,0.2]">[5.1,3.5,1.4,0.2],[4.9,3,1.4,0.2],[6,2.9,4.5,1.5],[5.7,2.6,3.5,1]</textarea>
          <label></label>
          <button class="btn btn-success" onclick="download_decisiontree()"><span class="glyphicon glyphicon-download-alt"></span>
            Download Decision Tree module</button>
          <button class="btn" onclick="prediction_decision()">Decision Tree Prediction</button>
          <div id="result_dicision"></div>
          <hr>
        </div>

        <div class="predict_randomforest" style="display:none;">
          <label>Random Forest Prediction data</label>
          <textarea id="predict_randomforest_input" rows="3" placeholder="[5.1,3.5,1.4,0.2]">[5.1,3.5,1.4,0.2],[4.9,3,1.4,0.2],[6,2.9,4.5,1.5],[5.7,2.6,3.5,1]</textarea>
          <label></label>
          <button class="btn btn-success" onclick="download_randomforest()">
            <span class="glyphicon glyphicon-download-alt"></span>
            Download Random Forest module</button>
          <button class="btn" onclick="prediction_randomforest()">Random Forest Prediction</button>
          <div id="result_randomforest"></div>
          <hr>
        </div>

        

      </fieldset>
      <div style="margin:10px;">
        <input type="file" id="file-input" >
        <div id="file-content"></div>
        <button class="btn" onclick="loadmodule()">Upload</button>
      </div>
      

      <div style="margin-bottom: 200px;"></div>
    </div>


<script type="text/javascript">
content='';
uploadjson={};
//read file function
function readSingleFile(e) {
  //console.log(e);
  file = e.target.files[0];
  if (!file) {
    return;
  }
  var reader = new FileReader();
  reader.onload = function(e) {
    var contents = e.target.result;
    // Display file content
    //displayContents(contents);
    uploadjson=JSON.parse(contents);
  };
  reader.readAsText(file);

}
 
function loadmodule()
{
  if(uploadjson['name'] == 'LogisticRegression')
  {
    alert(uploadjson['name']);
    load_lg=new LG(uploadjson);
  }
  if(uploadjson['name'] == 'PCA')
  {
    alert(uploadjson['name']);
    load_pca=ML.PCA.load(uploadjson);
  }
  if(uploadjson['name'] == 'DTClassifier')
  {
    alert(uploadjson['name']);
  }
  
}
function displayContents(contents) {
  var element = document.getElementById('file-content');
  element.innerHTML = contents;
}
 
document.getElementById('file-input').addEventListener('change', readSingleFile, false);
//

function download(filename, text) {
  var element = document.createElement('a');
  element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
  element.setAttribute('download', filename);
element.style.display = 'none';
  document.body.appendChild(element);
element.click();
document.body.removeChild(element);
}
// Start file download.
//download("hello.txt","This is the content of my file :)");


function getinforvalue(trainid){
  //get the html data
  var decision_data=document.getElementById(trainid).value;
  //decision_label=document.getElementById("label_decision").value;

  //transforme data formate.
  var decision_data='['+decision_data+']';
  var decision_data_a=JSON.parse(decision_data);
  return decision_data_a;

}
// getinforvalue('training_decision')


function getinforlabel(lableid){
  //get the html data
  //decision_data=document.getElementById("training_decision").value;
  var decision_label=document.getElementById(lableid).value;

  //transforme data formate.

  var decision_label_a=decision_label.split(',').map(function(item) {
	return parseFloat(item);
  })
  return decision_label_a;
}
// getinforlabel('label_decision');

function train_pca(){
  //get the html data
  pca_data_a=getinforvalue('training_decision');
  pca_label_a=getinforlabel('label_decision');


//Use new dataset to calculate the PCA module.
pca=new ML.PCA(pca_data_a);

//export the PCA module parameter.
pca_result=pca.toJSON();


predict_result=pca.predict(pca_data_a);

//
$(".predict_pca").show();

//threedplot(pca_data_a,'3dplot');
//threedplot(predict_result,'3dplotnew');

threedlabelplot(pca_data_a,pca_label_a,'3dplot');
threedlabelplot(predict_result,pca_label_a,'3dplotnew');
}
function download_pca(){
  var text=pca.toJSON();
  myJSON = JSON.stringify(text);
  download("pca_parameters.txt",myJSON);
}

function train_logistic(){
  //get the html data
  logistic_data=getinforvalue('training_decision');
  logistic_label=getinforlabel('label_decision');

  //set the data formation.
  var X = new ML.Matrix(logistic_data);
  var Y = ML.Matrix.columnVector(logistic_label);

  // we will train our model
  logreg = new LG({numSteps: 1000, learningRate: 5e-3});

  //train data.
  logreg.train(X,Y);
  $(".predict_logistic").show();

}
function download_logistic(){
  var text=logreg.toJSON();
  myJSON = JSON.stringify(text);
  download("logisticregression_parameters.txt",myJSON);
}

function prediction_logistic(){
    //predict_decision
    //get the html data
    predict_data=getinforvalue('predict_decision_input');
    predict_data_a=new ML.Matrix(predict_data);

    //Predict the data
    var result_logreg = logreg.predict(predict_data_a);

    $("#result_logistic").html('<p>Logistic Regression Prediction results:'+result_logreg+'</p>');


}


function train_decision(){
  //get the html data
  decision_data_a=getinforvalue('training_decision');
  decision_label_a=getinforlabel('label_decision');
  
  //set decision parameter
  var options = {
  gainFunction: 'gini',
  maxDepth: 10,
  minNumSamples: 3
  };

  //Generate a decision module.
  classifier_decision = new ML.DecisionTreeClassifier(options);

  //Training the data
  classifier_decision.train(decision_data_a, decision_label_a);

  $(".predict_decision").show();

}
function download_decisiontree(){
  var text=classifier_decision.toJSON();
  myJSON = JSON.stringify(text);
  download("decisiontree_parameters.txt",myJSON);

}

function prediction_decision(){
  //predict_decision
    //get the html data
    predict_data_a=getinforvalue('predict_decision_input');

    //Predict the data
    var result_decision = classifier_decision.predict(predict_data_a);

    $("#result_dicision").html('<p>Decision Tree Prediction results:'+result_decision+'</p>');

}

function train_randomforest(){
  //get the html data
  decision_data_a=getinforvalue('training_decision');
  decision_label_a=getinforlabel('label_decision');
  
  //set decision parameter
  var options = {
  seed: 3,
  maxFeatures: 0.8,
  replacement: true,
  nEstimators: 25
  };

  //Generate a decision module.
  classifier_randomforest = new ML.DecisionTreeClassifier(options);

  //Training the data
  classifier_randomforest.train(decision_data_a, decision_label_a);

  $(".predict_randomforest").show();

}

function download_randomforest(){
  var text=classifier_randomforest.toJSON();
  myJSON = JSON.stringify(text);
  download("randomforest_parameters.txt",myJSON);

}

function prediction_randomforest()
{

  //predict_decision
  //get the html data
    predict_data_a=getinforvalue('predict_randomforest_input');

    //Predict the data
    var result = classifier_randomforest.predict(predict_data_a);

    $("#result_randomforest").html('<p>Random Forest Prediction results:'+result+'</p>');

}


 function decision_tree(){
  htmlcontent='';
  trainingSet= MLDataset.getNumbers();
  predictions = MLDataset.getClasses()
  .map((elem) => MLDataset.getDistinctClasses().indexOf(elem));
  
  var options = {
  gainFunction: 'gini',
  maxDepth: 10,
  minNumSamples: 3
  };

  var classifier = new ML.DecisionTreeClassifier(options);
  classifier.train(trainingSet, predictions);
  result = classifier.predict(trainingSet);
  training_string=JSON.stringify(trainingSet);
  prediction_string=JSON.stringify(predictions);
  htmlcontent+='<p>'+training_string+'</p>';
  htmlcontent+='<p>'+prediction_string+'</p>';
  document.getElementById('decision_info').innerHTML = htmlcontent;

 }


function exponential(){
  expx=document.getElementById("exponentialx").value;
  expy=document.getElementById("exponentialy").value;
  /*
  if(expx !=""){
    alert(expx);
  }
  if(expy !=""){
    alert(expy);
  }
  */
  expx_a=expx.split(',').map(function(item) {
	return parseFloat(item);
});

  expy_a=expy.split(',').map(function(item) {
	return parseFloat(item);
});

var regression = new ML.ExponentialRegression(expx_a, expy_a);
 exp_pre_y=[];
 equation=regression.toString(3);
for (var i=0;i<expx_a.length;i++){
  exp_pre_y.push(regression.predict(expx_a[i]));
}
var trace1 = {
  x: expx_a,
  y: expy_a,
  mode: 'markers',
  type: 'scatter',
  name:'Origin'
};
var trace2 = {
  x: expx_a,
  y: exp_pre_y,
  mode: 'lines+markers',
  type: 'scatter',
  name: equation,
  line: {shape: 'spline'}
};
var data = [trace1,trace2];
Plotly.newPlot('plot', data);

}
function pca(){
// PCA begin
const dataset=MLDataset.getNumbers();
pca=new ML.PCA(dataset);
console.log(pca.getExplainedVariance());
const newPoints = [[4.9, 3.2, 1.2, 0.4], [5.4, 3.3, 1.4, 0.9]];
console.log(pca.predict(newPoints)); // project new points into the PCA space
// PCA end
}

function svm(){
//
// SVM begin
//

var options = {
  C: 0.01,
  tol: 10e-4,
  maxPasses: 10,
  maxIterations: 10000,
  kernel: 'rbf',
  kernelOptions: {
    sigma: 0.5
  }
};

var svm = new ML.SVM(options);

// Train the classifier - we give him an xor
var features = [[0,0],[0,1],[1,1],[1,0]];
var labels = [1, -1, 1, -1];
svm.train(features, labels);

// Let's see how narrow the margin is
var margins = svm.margin(features);

// Let's see if it is separable by testing on the training data
svm.predict(features); // [1, -1, 1, -1]

// I want to see what my support vectors are
var supportVectors = svm.supportVectors();
 
// Now we want to save the model for later use
var model = svm.toJSON();

/// ... later, you can make predictions without retraining the model
var importedSvm = ML.SVM.load(model);
importedSvm.predict(features); // [1, -1, 1, -1] 
}

function naive_bayes(){
//
// naive-bayes being
//

//GaussianNB
// assuming that you created Xtrain, Xtest, Ytrain, Ytest

/*
var model = new ML.NaiveBayes.GaussianNB();
model.train(Xtrain, Ytrain);

var predictions = model.predict(Xtest);
*/

//
// naive-bayes end
//
}
function regression(){
//
//regression-simple-linear begin
//
const x = [0.5, 1, 1.5, 2, 2.5];
const y = [0, 1, 2, 3, 4];

const regression = new ML.SimpleLinearRegression(x, y);

regression.slope // 2
regression.intercept // -1
regression.coefficients // [-1, 2]

regression.predict(3); // 5
regression.computeX(3.5); // 2.25

regression.toString(); // 'f(x) = 2 * x - 1'

regression.score(x, y);
// { r: 1, r2: 1, chi2: 0, rmsd: 0 }

const json = regression.toJSON();
// { name: 'simpleLinearRegression', slope: 2, intercept: -1 }
const loaded = ML.SimpleLinearRegression.load(json);
loaded.predict(5) // 9

//
//regression-simple-linear end
//
}

function multivariable(){
//
//Multivariate linear regression begin
//
const x = [[0, 0], [1, 2], [2, 3], [3, 4]];
// Y0 = X0 * 2, Y1 = X1 * 2, Y2 = X0 + X1
const y = [[0, 0, 0], [2, 4, 3], [4, 6, 5], [6, 8, 7]];
const mlr = new ML.MLR(x, y);
console.log(mlr.predict([3, 3]));
// [6, 6, 6]
//
//Multivariate linear regression end
//
}
data3d=[[[1.4,2.5,3.4], [14,15.7,61],[27,18,9.5]],[[11,2,31], [14,15,6], [17,18,9]]];
function threedplot(data3d, nameid){
  var x1=[];
  var y1=[];
  var z1=[];
  var x2=[];
  var y2=[];
  var z2=[];

if(data3d.length == 2){

  for (var i in data3d[0])
  {

  x1.push(data3d[0][i][0]);
  y1.push(data3d[0][i][1]);
  z1.push(data3d[0][i][2]);

  }
  var trace1 = {
    x:x1,
    y:y1,
    z:z1,

	mode: 'markers',
	marker: 
    {
		  size: 4,
      line: {
      //color: 'rgba(217, 217, 217, 0.14)',
      width: 0.5
      },
		  opacity: 0.8
    },
	type: 'scatter3d'
  };

  for (var i in data3d[1]){
    x2.push(data3d[1][i][0]);
    y2.push(data3d[1][i][1]);
    z2.push(data3d[1][i][2]);
}

trace2 = {
    x:x2,
    y:y2,
    z:z2,
    mode: 'markers',
    marker: 
    {
      //color: 'rgb(127, 127, 127)',
      size: 4,
      symbol: 'circle',
      line: 
        {
        //color: 'rgb(204, 204, 204)',
        width: 1
        },
      opacity: 0.8
      },
    type: 'scatter3d'
  };
  var data = [trace1,trace2];

}else{
  //one demail
  for (var i in data3d)
  {

  x1.push(data3d[i][0]);
  y1.push(data3d[i][1]);
  z1.push(data3d[i][2]);

  }
  var trace1 = {
    x:x1,
    y:y1,
    z:z1,

	mode: 'markers',
	marker: 
    {
		  size: 4,
      line: {
      //color: 'rgba(217, 217, 217, 0.14)',
      width: 0.5
      },
		  opacity: 0.8
    },
	type: 'scatter3d'
  };
  var data = [trace1];
  
}
  
  var layout = {
      
    };
  Plotly.newPlot(nameid, data, layout);


}
function threedlabelplot(data3d, label,nameid){
  function sort_unique(arr) {
  if (arr.length === 0) return arr;
  arr = arr.sort(function (a, b) { return a*1 - b*1; });
  var ret = [arr[0]];
  for (var i = 1; i < arr.length; i++) { //Start loop at 1: arr[0] can never be a duplicate
    if (arr[i-1] !== arr[i]) {
      ret.push(arr[i]);
    }
  }
  return ret;
}

  label_unique=sort_unique(label);
  for (var i =0; i < label_unique.length; i++)
  {
    window['orderarray_'+i]=[];
    window['x_'+i]=[];
    window['y_'+i]=[];
    window['z_'+i]=[];
    for(var j=0;j<label.length;j++){
      if(label[j]==label_unique[i])
      {
        window['orderarray_'+i].push(j);
      }
    }
  }

for(var i =0; i < label_unique.length; i++){
  for(var j=0;j<window['orderarray_'+i].length;j++){
    window['x_'+i].push(data3d[window['orderarray_'+i][j]][0]);
    window['y_'+i].push(data3d[window['orderarray_'+i][j]][1]);
    window['z_'+i].push(data3d[window['orderarray_'+i][j]][2]);
  }
}
var data=[];
for(var i =0; i < label_unique.length; i++)
{
  window['trace'+i]={
    x:window['x_'+i],
    y:window['y_'+i],
    z:window['z_'+i],
    name:i,

	mode: 'markers',
	marker: 
    {
		  size: 4,
      line: {
      //color: 'rgba(217, 217, 217, 0.14)',
      width: 0.5
      },
		  opacity: 0.8
    },
	type: 'scatter3d'
  }
  data.push(window['trace'+i]);

}

var layout = {};
Plotly.newPlot(nameid, data, layout);
}




</script>  



</body>
</html>